<!DOCTYPE html><html lang="zh-Hans"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="Learn how to build a personal website using Next.js"/><meta property="og:image" content="https://og-image.now.sh/Swordword&#x27;s%20blog.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="og:title" content="Swordword&#x27;s blog"/><title>Node.js和Webhooks同步项目</title><meta name="next-head-count" content="7"/><link rel="preload" href="/_next/static/css/876d048b5dab7c28.css" as="style"/><link rel="stylesheet" href="/_next/static/css/876d048b5dab7c28.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-d0adf646434a14b2.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-7c48f75ce2db1491.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e272e05dd28ef959.js" defer=""></script><script src="/_next/static/chunks/130-b952c5d507d712ac.js" defer=""></script><script src="/_next/static/chunks/749-555cb8054e68346e.js" defer=""></script><script src="/_next/static/chunks/241-e8e3e8578555aa77.js" defer=""></script><script src="/_next/static/chunks/783-464c81cbfd42177e.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-4108770bd2d21ccc.js" defer=""></script><script src="/_next/static/8pHPw-9lAjYkM6xwLVhD3/_buildManifest.js" defer=""></script><script src="/_next/static/8pHPw-9lAjYkM6xwLVhD3/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css dbbey5">.css-dbbey5{width:100vw;height:100vh;overflow-y:scroll;background:#eee;color:#3c4858;padding-bottom:50px;}</style><div class="css-dbbey5"><style data-emotion="css gpj3uu">.css-gpj3uu{width:100%;height:50px;color:#fff;background-color:rgba(47,65,84,0.7);box-shadow:0 2px 5px 0 rgb(0 0 0 / 16%),0 2px 10px 0 rgb(0 0 0 / 12%);position:fixed;top:0;left:0;z-index:2;}</style><div class="css-gpj3uu"><style data-emotion="css qjodyr">.css-qjodyr{width:1100px;height:100%;margin:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-qjodyr"><a href="/"><style data-emotion="css 19m5m0c">.css-19m5m0c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;}</style><div class="css-19m5m0c"><style data-emotion="css l2tq7e">.css-l2tq7e{width:30px;height:30px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-l2tq7e"><style data-emotion="css brme6v">.css-brme6v{width:24px;height:24px;margin-left:6px;}</style><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-sword"></use></svg></div><style data-emotion="css 879ic9">.css-879ic9{margin-left:20px;}</style><div class="css-879ic9">Swordword</div></div></a><style data-emotion="css fhxb3m">.css-fhxb3m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-fhxb3m"><a href="/"><style data-emotion="css kfc5ms">.css-kfc5ms{width:100px;height:50px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;}.css-kfc5ms:hover{color:#30A9DE;background-color:rgba(0,0,0,0.1);}</style><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-home"></use></svg></div><style data-emotion="css 1a2afmv">.css-1a2afmv{margin-left:10px;}</style><div class="css-1a2afmv">首页</div></div></a><style data-emotion="css 1lwiia1">.css-1lwiia1{width:100px;height:50px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;position:relative;}.css-1lwiia1:hover .nav-list{display:block;}</style><div class="css-1lwiia1"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-list"></use></svg></div><div class="css-1a2afmv">索引</div><style data-emotion="css su4vv2">.css-su4vv2{-webkit-transition:3s ease-out;transition:3s ease-out;display:none;width:100px;position:absolute;top:50px;left:0;background-color:rgba(47,65,84,0.7);box-shadow:0 2px 5px 0 rgb(0 0 0 / 16%),0 2px 10px 0 rgb(0 0 0 / 12%);}</style><div class="nav-list css-su4vv2"><a href="/archive"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-guidang"></use></svg></div><div class="css-1a2afmv">归档</div></div></a><a href="/category"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-leimupinleifenleileibie2"></use></svg></div><div class="css-1a2afmv">分类</div></div></a><a href="/tag"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-tag1"></use></svg></div><div class="css-1a2afmv">标签</div></div></a></div></div><a href="/about"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-lianhe4"></use></svg></div><div class="css-1a2afmv">关于</div></div></a><a href="/rss"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-rss"></use></svg></div><div class="css-1a2afmv">RSS</div></div></a><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-OOjs_UI_icon_search-ltr"></use></svg></div><div class="css-1a2afmv"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-sun"></use></svg></div></div></div></div></div><style data-emotion="css 1739oy8">.css-1739oy8{z-index:1;}</style><div class="css-1739oy8"><style data-emotion="css z6d19t">.css-z6d19t{width:100%;height:350px;position:relative;background:url(/_next/static/media/banner.eb35a883.jpg) center;}</style><div class="css-z6d19t"></div></div><style data-emotion="css 3vwp2t">.css-3vwp2t{position:relative;width:1100px;background:#fff;padding:50px 100px;margin:-150px auto 50px;border-radius:8px;}</style><main class="css-3vwp2t"><article style="color:#3c4858"><style data-emotion="css yrjjfw">.css-yrjjfw{height:70px;margin:0;line-height:70px;text-align:center;font-size:40px;}</style><h1 class="css-yrjjfw">Node.js和Webhooks同步项目</h1><style data-emotion="css faxeo3">.css-faxeo3{margin-left:250px;}</style><div class="css-faxeo3"><style data-emotion="css hc4w4d">.css-hc4w4d{height:40px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-hc4w4d"><style data-emotion="css 12qt3ml">.css-12qt3ml{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-12qt3ml"><style data-emotion="css 2ldgmb">.css-2ldgmb{color:#30a9de;}</style><small class="css-2ldgmb"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-time"></use></svg></div></small><style data-emotion="css qq1p72">.css-qq1p72{margin-left:10px;margin-right:20px;cursor:pointer;}</style><small class="css-qq1p72"><a href="/archive"><span><time dateTime="2020-06-28T22:58:19.000Z">20-06-28</time></span></a></small></div><div class="css-12qt3ml"><small class="css-2ldgmb"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-leimupinleifenleileibie2"></use></svg></div></small><small class="css-qq1p72"><a href="/category"><span>前往分类</span></a></small></div><div class="css-12qt3ml"><small class="css-2ldgmb"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-tag1"></use></svg></div></small><small class="css-qq1p72"><a href="/tag/git"><span>Git<!-- --> </span></a><a href="/tag/node"><span>Node<!-- --> </span></a><a href="/tag/webhook"><span>Webhook<!-- --> </span></a></small></div></div></div><style data-emotion="css h25mx1">.css-h25mx1{border-bottom:1px solid #30a9de;margin-top:20px;margin-bottom:20px;}</style><div class="css-h25mx1"></div><div><ol>
<li>
<p><strong>设置Webhook</strong></p>
<p>登录github导航到待监控的存储库，选中设置里面的webhook，添加新的webhook</p>
<ul>
<li>在<strong>payLoad URL</strong>中，填写即将编写的Node.js服务器地址+端</li>
<li>将内容类型设为 <code>application/json</code></li>
<li>在Secret中，输入该webhook的密码，之后nodeJS会使用它验证hook</li>
<li>选中触发事件的类型，通常选择推送事件，</li>
<li>选择<strong>活动</strong>复选框</li>
</ul>
<p><img src="http://img.massivejohn.com/webhook.png" alt=""></p>
</li>
<li>
<p><strong>将存储库克隆到服务器</strong></p>
</li>
<li>
<p><strong>创建Webhook脚本</strong></p>
<ul>
<li>
<p><code>mkdir ~/NodeWebhooks&#x26;&#x26; cd ~/NodeWebhooks &#x26;&#x26; touch webhook.js </code></p>
</li>
<li>
<pre><code><span>const</span> secret = <span>"your_secret_here"</span>;
<span>const</span> repo = <span>"~/your_repo_path_here/"</span>;
<span>const</span> http = <span>require</span>(<span>'http'</span>);
<span>const</span> crypto = <span>require</span>(<span>'crypto'</span>);
<span>const</span> exec = <span>require</span>(<span>'child_process'</span>).<span>exec</span>;
http.<span>createServer</span>(<span>function</span> (<span>req, res</span>) {
    req.<span>on</span>(<span>'data'</span>, <span>function</span>(<span>chunk</span>) {
        <span>let</span> sig = <span>"sha1="</span> + crypto.<span>createHmac</span>(<span>'sha1'</span>, secret).<span>update</span>(chunk.<span>toString</span>()).<span>digest</span>(<span>'hex'</span>);
        <span>if</span> (req.<span>headers</span>[<span>'x-hub-signature'</span>] == sig) {
            <span>exec</span>(<span>'cd '</span> + repo + <span>' &#x26;&#x26; git pull &#x26;&#x26; pm2 restart webhook'</span>);
        }
    });
    res.<span>end</span>();
}).<span>listen</span>(<span>8002</span>);</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>测试Webhook</strong></p>
<ol>
<li><code>node webhook.js</code></li>
<li>返回<a href="https://github.com/">Github.com</a>上,找到菜单中的“ <strong>Webhooks</strong> ”，找到<strong>Recent Exiveries</strong>，点击三个点 单击<code>Redeliver</code>重复测试请求</li>
</ol>
</li>
<li>
<p><strong>push测试成功</strong></p>
<p><em>需要等一段时间</em>,使用pm2持续集成</p>
</li>
</ol>
</div></article></main></div><style data-emotion="css 1st94pw">.css-1st94pw{text-align:center;height:30px;line-height:30px;color:#333;}</style><div class="css-1st94pw"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noreferrer">京ICP备19054504号-2</a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"git代码多端同步","contentHtml":"\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e设置Webhook\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e登录github导航到待监控的存储库，选中设置里面的webhook，添加新的webhook\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e在\u003cstrong\u003epayLoad URL\u003c/strong\u003e中，填写即将编写的Node.js服务器地址+端\u003c/li\u003e\n\u003cli\u003e将内容类型设为 \u003ccode\u003eapplication/json\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e在Secret中，输入该webhook的密码，之后nodeJS会使用它验证hook\u003c/li\u003e\n\u003cli\u003e选中触发事件的类型，通常选择推送事件，\u003c/li\u003e\n\u003cli\u003e选择\u003cstrong\u003e活动\u003c/strong\u003e复选框\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"http://img.massivejohn.com/webhook.png\" alt=\"\"\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e将存储库克隆到服务器\u003c/strong\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e创建Webhook脚本\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003e\u003ccode\u003emkdir ~/NodeWebhooks\u0026#x26;\u0026#x26; cd ~/NodeWebhooks \u0026#x26;\u0026#x26; touch webhook.js \u003c/code\u003e\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan\u003econst\u003c/span\u003e secret = \u003cspan\u003e\"your_secret_here\"\u003c/span\u003e;\n\u003cspan\u003econst\u003c/span\u003e repo = \u003cspan\u003e\"~/your_repo_path_here/\"\u003c/span\u003e;\n\u003cspan\u003econst\u003c/span\u003e http = \u003cspan\u003erequire\u003c/span\u003e(\u003cspan\u003e'http'\u003c/span\u003e);\n\u003cspan\u003econst\u003c/span\u003e crypto = \u003cspan\u003erequire\u003c/span\u003e(\u003cspan\u003e'crypto'\u003c/span\u003e);\n\u003cspan\u003econst\u003c/span\u003e exec = \u003cspan\u003erequire\u003c/span\u003e(\u003cspan\u003e'child_process'\u003c/span\u003e).\u003cspan\u003eexec\u003c/span\u003e;\nhttp.\u003cspan\u003ecreateServer\u003c/span\u003e(\u003cspan\u003efunction\u003c/span\u003e (\u003cspan\u003ereq, res\u003c/span\u003e) {\n    req.\u003cspan\u003eon\u003c/span\u003e(\u003cspan\u003e'data'\u003c/span\u003e, \u003cspan\u003efunction\u003c/span\u003e(\u003cspan\u003echunk\u003c/span\u003e) {\n        \u003cspan\u003elet\u003c/span\u003e sig = \u003cspan\u003e\"sha1=\"\u003c/span\u003e + crypto.\u003cspan\u003ecreateHmac\u003c/span\u003e(\u003cspan\u003e'sha1'\u003c/span\u003e, secret).\u003cspan\u003eupdate\u003c/span\u003e(chunk.\u003cspan\u003etoString\u003c/span\u003e()).\u003cspan\u003edigest\u003c/span\u003e(\u003cspan\u003e'hex'\u003c/span\u003e);\n        \u003cspan\u003eif\u003c/span\u003e (req.\u003cspan\u003eheaders\u003c/span\u003e[\u003cspan\u003e'x-hub-signature'\u003c/span\u003e] == sig) {\n            \u003cspan\u003eexec\u003c/span\u003e(\u003cspan\u003e'cd '\u003c/span\u003e + repo + \u003cspan\u003e' \u0026#x26;\u0026#x26; git pull \u0026#x26;\u0026#x26; pm2 restart webhook'\u003c/span\u003e);\n        }\n    });\n    res.\u003cspan\u003eend\u003c/span\u003e();\n}).\u003cspan\u003elisten\u003c/span\u003e(\u003cspan\u003e8002\u003c/span\u003e);\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003e测试Webhook\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\u003ccode\u003enode webhook.js\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e返回\u003ca href=\"https://github.com/\"\u003eGithub.com\u003c/a\u003e上,找到菜单中的“ \u003cstrong\u003eWebhooks\u003c/strong\u003e ”，找到\u003cstrong\u003eRecent Exiveries\u003c/strong\u003e，点击三个点 单击\u003ccode\u003eRedeliver\u003c/code\u003e重复测试请求\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cstrong\u003epush测试成功\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003e\u003cem\u003e需要等一段时间\u003c/em\u003e,使用pm2持续集成\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n","title":"Node.js和Webhooks同步项目","date":"2020-06-28T22:58:19.000Z","description":"git 多端代码同步","tag":"Git、Node、Webhook"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"git代码多端同步"},"buildId":"8pHPw-9lAjYkM6xwLVhD3","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>