<!DOCTYPE html><html lang="zh-Hans"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="Learn how to build a personal website using Next.js"/><meta property="og:image" content="https://og-image.now.sh/Swordword&#x27;s%20blog.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="og:title" content="Swordword&#x27;s blog"/><title>js实现自定义监听器</title><meta name="next-head-count" content="7"/><link rel="preload" href="/_next/static/css/876d048b5dab7c28.css" as="style"/><link rel="stylesheet" href="/_next/static/css/876d048b5dab7c28.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-a03f34702f60fafc.js" defer=""></script><script src="/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/_next/static/chunks/main-7c48f75ce2db1491.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e272e05dd28ef959.js" defer=""></script><script src="/_next/static/chunks/130-b952c5d507d712ac.js" defer=""></script><script src="/_next/static/chunks/749-555cb8054e68346e.js" defer=""></script><script src="/_next/static/chunks/241-e8e3e8578555aa77.js" defer=""></script><script src="/_next/static/chunks/783-464c81cbfd42177e.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-4108770bd2d21ccc.js" defer=""></script><script src="/_next/static/Xajds82wgprlLoQfKFbdB/_buildManifest.js" defer=""></script><script src="/_next/static/Xajds82wgprlLoQfKFbdB/_ssgManifest.js" defer=""></script></head><body><div id="__next"><style data-emotion="css dbbey5">.css-dbbey5{width:100vw;height:100vh;overflow-y:scroll;background:#eee;color:#3c4858;padding-bottom:50px;}</style><div class="css-dbbey5"><style data-emotion="css gpj3uu">.css-gpj3uu{width:100%;height:50px;color:#fff;background-color:rgba(47,65,84,0.7);box-shadow:0 2px 5px 0 rgb(0 0 0 / 16%),0 2px 10px 0 rgb(0 0 0 / 12%);position:fixed;top:0;left:0;z-index:2;}</style><div class="css-gpj3uu"><style data-emotion="css qjodyr">.css-qjodyr{width:1100px;height:100%;margin:auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-qjodyr"><a href="/"><style data-emotion="css 19m5m0c">.css-19m5m0c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;}</style><div class="css-19m5m0c"><style data-emotion="css l2tq7e">.css-l2tq7e{width:30px;height:30px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-l2tq7e"><style data-emotion="css brme6v">.css-brme6v{width:24px;height:24px;margin-left:6px;}</style><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-sword"></use></svg></div><style data-emotion="css 879ic9">.css-879ic9{margin-left:20px;}</style><div class="css-879ic9">Swordword</div></div></a><style data-emotion="css fhxb3m">.css-fhxb3m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-fhxb3m"><a href="/"><style data-emotion="css kfc5ms">.css-kfc5ms{width:100px;height:50px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;}.css-kfc5ms:hover{color:#30A9DE;background-color:rgba(0,0,0,0.1);}</style><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-home"></use></svg></div><style data-emotion="css 1a2afmv">.css-1a2afmv{margin-left:10px;}</style><div class="css-1a2afmv">首页</div></div></a><style data-emotion="css 1lwiia1">.css-1lwiia1{width:100px;height:50px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;cursor:pointer;position:relative;}.css-1lwiia1:hover .nav-list{display:block;}</style><div class="css-1lwiia1"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-list"></use></svg></div><div class="css-1a2afmv">索引</div><style data-emotion="css su4vv2">.css-su4vv2{-webkit-transition:3s ease-out;transition:3s ease-out;display:none;width:100px;position:absolute;top:50px;left:0;background-color:rgba(47,65,84,0.7);box-shadow:0 2px 5px 0 rgb(0 0 0 / 16%),0 2px 10px 0 rgb(0 0 0 / 12%);}</style><div class="nav-list css-su4vv2"><a href="/archive"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-guidang"></use></svg></div><div class="css-1a2afmv">归档</div></div></a><a href="/category"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-leimupinleifenleileibie2"></use></svg></div><div class="css-1a2afmv">分类</div></div></a><a href="/tag"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-tag1"></use></svg></div><div class="css-1a2afmv">标签</div></div></a></div></div><a href="/about"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-lianhe4"></use></svg></div><div class="css-1a2afmv">关于</div></div></a><a href="/rss"><div class="css-kfc5ms"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-rss"></use></svg></div><div class="css-1a2afmv">RSS</div></div></a><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-OOjs_UI_icon_search-ltr"></use></svg></div><div class="css-1a2afmv"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-sun"></use></svg></div></div></div></div></div><style data-emotion="css 1739oy8">.css-1739oy8{z-index:1;}</style><div class="css-1739oy8"><style data-emotion="css z6d19t">.css-z6d19t{width:100%;height:350px;position:relative;background:url(/_next/static/media/banner.eb35a883.jpg) center;}</style><div class="css-z6d19t"></div></div><style data-emotion="css 3vwp2t">.css-3vwp2t{position:relative;width:1100px;background:#fff;padding:50px 100px;margin:-150px auto 50px;border-radius:8px;}</style><main class="css-3vwp2t"><article style="color:#3c4858"><style data-emotion="css yrjjfw">.css-yrjjfw{height:70px;margin:0;line-height:70px;text-align:center;font-size:40px;}</style><h1 class="css-yrjjfw">js实现自定义监听器</h1><style data-emotion="css faxeo3">.css-faxeo3{margin-left:250px;}</style><div class="css-faxeo3"><style data-emotion="css hc4w4d">.css-hc4w4d{height:40px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-hc4w4d"><style data-emotion="css 12qt3ml">.css-12qt3ml{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-box-pack:start;-ms-flex-pack:start;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-12qt3ml"><style data-emotion="css 2ldgmb">.css-2ldgmb{color:#30a9de;}</style><small class="css-2ldgmb"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-time"></use></svg></div></small><style data-emotion="css qq1p72">.css-qq1p72{margin-left:10px;margin-right:20px;cursor:pointer;}</style><small class="css-qq1p72"><a href="/archive"><span><time dateTime="2020-12-23T14:03:56.000Z">20-12-23</time></span></a></small></div><div class="css-12qt3ml"><small class="css-2ldgmb"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-leimupinleifenleileibie2"></use></svg></div></small><small class="css-qq1p72"><a href="/category"><span>前往分类</span></a></small></div><div class="css-12qt3ml"><small class="css-2ldgmb"><div class="css-l2tq7e"><svg class="icon css-brme6v" aria-hidden="true"><use xlink:href="#icon-tag1"></use></svg></div></small><small class="css-qq1p72"><a href="/tag/javascript"><span>JavaScript<!-- --> </span></a></small></div></div></div><style data-emotion="css h25mx1">.css-h25mx1{border-bottom:1px solid #30a9de;margin-top:20px;margin-bottom:20px;}</style><div class="css-h25mx1"></div><div><p>js中的自定义监听器分为浏览器DOM端、Node端，最后可以自己实现一个自定义监听器</p>
<h3 id="user-content-浏览器端"><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AB%AF" aria-hidden="true" tabindex="-1"><span></span></a>浏览器端</h3>
<p>浏览器端的自定义监听器可以通过原生的**<code>Event</code><strong>和</strong><code>CustomEvent</code>**构造函数实现</p>
<p>**<code>Event</code>**语法 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Event/Event">基础</a></p>
<p><strong><code>CustomEvent</code></strong><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CustomEvent">基础</a></p>
<p><code>CustomEvent</code>相比<code>Event</code>的优势是有个<code>detail</code>字段可以为事件传入自定义参数</p>
<p>举例使用</p>
<p>在两个独立的模块：商品购买，购物车中，可以在购买页面定义一个自定义监听器 <strong>BuyEvent</strong>，再在其他模块中监听该事件。当用户购买商品时，通过<code>dispatchEvent</code>触发该事件</p>
<p><strong>buy模块</strong></p>
<pre><code><span>// btnElem 购买按钮	</span>
btnElem.<span>addEventListener</span>(<span>'click'</span>, <span>(<span>e</span>) =></span> {
  <span>// goodInfo 商品信息</span>
  <span>const</span> buyEvent = <span>new</span> <span>CustomEvent</span>(<span>'buyEvent'</span>, {
    <span>detail</span>: goodInfo,
  })
  <span>document</span>.<span>dispatchEvent</span>(buyEvent)
})</code></pre>
<p><strong>购物车模块</strong></p>
<pre><code><span>document</span>.<span>addEventListener</span>(<span>'buyEvent'</span>, <span>(<span>e</span>) =></span> {
  <span>console</span>.<span>log</span>(<span>`商品模块get，<span>${e.detail}</span>`</span>)
})</code></pre>
<h3 id="user-content-node端"><a href="#node%E7%AB%AF" aria-hidden="true" tabindex="-1"><span></span></a>Node端</h3>
<p>Node端自带了<strong>event</strong>模块可以实现监听器功能</p>
<pre><code><span>const</span> <span>EventEmitter</span> = <span>require</span>(<span>'events'</span>)

<span>const</span> myEvent = <span>new</span> <span>EventEmitter</span>()

myEvent.<span>on</span>(<span>'mEvent'</span>, <span>(<span>data</span>) =></span> {
  <span>console</span>.<span>log</span>(data)
})

myEvent.<span>emit</span>(<span>'mEvent'</span>, <span>'发射！！！'</span>)
</code></pre>
<h3 id="user-content-自定义事件监听器"><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8" aria-hidden="true" tabindex="-1"><span></span></a>自定义事件监听器</h3>
<p>可以自己实现一个自定义监听器实现上述功能</p>
<pre><code><span>class</span> <span>EventEmiter</span> {
  <span>constructor</span>(<span></span>) {
    <span>this</span>.<span>events</span> = []
  }
  <span>on</span>(<span>event, cb</span>) {
    <span>console</span>.<span>log</span>(<span>'this.events'</span>, <span>this</span>.<span>events</span>)
    <span>if</span> (<span>this</span>.<span>events</span>[event]) {
      <span>this</span>.<span>events</span>[event].<span>push</span>(cb)
    } <span>else</span> {
      <span>this</span>.<span>events</span>[event] = [cb]
    }
  }
  <span>emit</span>(<span>event</span>) {
    <span>const</span> cbList = <span>this</span>.<span>events</span>[event]
    <span>if</span> (!cbList) {
      <span>console</span>.<span>error</span>(<span>'你注册了事件嘛QAQ'</span>)
      <span>return</span>
    }
    <span>let</span> args = <span>Array</span>.<span>from</span>(<span>arguments</span>).<span>slice</span>(<span>1</span>)
    cbList.<span>forEach</span>(<span>(<span>cb</span>) =></span> {
      cb.<span>apply</span>(<span>this</span>, args)
    })
  }
}

<span>let</span> mEvent = <span>new</span> <span>EventEmiter</span>()
mEvent.<span>on</span>(<span>'mEvent'</span>, <span>(<span>data</span>) =></span> {
  <span>console</span>.<span>log</span>(<span>'got it'</span>, data)
})
<span>setTimeout</span>(<span>() =></span> {
  mEvent.<span>emit</span>(<span>'mEvent'</span>, <span>'发射！！！'</span>)
}, <span>2000</span>)
</code></pre>
<p>当然，如果你不想用<code>class</code>的话，用函数也可以实现（PS，这个世界越来越奇怪了，JS在向class靠，而C++却在惦记着函数式编程。。。）</p>
<pre><code><span>function</span> <span>EventEmiter</span>(<span></span>) {}
<span>EventEmiter</span>.<span><span>prototype</span></span>.<span>events</span> = {}
<span>EventEmiter</span>.<span><span>prototype</span></span>.<span>on</span> = <span>function</span> (<span>event, cb</span>) {
  <span>console</span>.<span>log</span>(<span>'this.events'</span>, <span>this</span>.<span>events</span>)
  <span>if</span> (<span>this</span>.<span>events</span>[event]) {
    <span>this</span>.<span>events</span>[event].<span>push</span>(cb)
  } <span>else</span> {
    <span>this</span>.<span>events</span>[event] = [cb]
  }
}
<span>EventEmiter</span>.<span><span>prototype</span></span>.<span>emit</span> = <span>function</span> (<span>event</span>) {
  <span>const</span> cbList = <span>this</span>.<span>events</span>[event]
  <span>if</span> (!cbList) {
    <span>console</span>.<span>error</span>(<span>'你注册了事件嘛QAQ'</span>)
    <span>return</span>
  }
  <span>let</span> args = <span>Array</span>.<span>from</span>(<span>arguments</span>).<span>slice</span>(<span>1</span>)
  cbList.<span>forEach</span>(<span>(<span>cb</span>) =></span> {
    cb.<span>apply</span>(<span>this</span>, args)
  })
}

<span>let</span> foo = <span>new</span> <span>EventEmiter</span>()

<span>/**
 * 或者这样也行
 * function foo(num) {
  this.events = {}
  }
 Object.setPrototypeOf(foo, EventEmiter.prototype)
 */</span>

foo.<span>on</span>(<span>'mEvent'</span>, <span>function</span> (<span>res, a</span>) {
  <span>console</span>.<span>log</span>(<span>'success'</span>, res, a)
})


<span>setTimeout</span>(<span>() =></span> {
  foo.<span>emit</span>(<span>'mEvent'</span>, <span>'发射！！！'</span>, <span>'剩余氧气: undefined'</span>)
}, <span>1000</span>)
</code></pre>
<h3 id="user-content-总结"><a href="#%E6%80%BB%E7%BB%93" aria-hidden="true" tabindex="-1"><span></span></a>总结</h3>
<p>监听器本质是一个个<strong>事件</strong>，是<strong>观察者模式</strong>的实现。OVER！！！</p>
</div></article></main></div><style data-emotion="css 1st94pw">.css-1st94pw{text-align:center;height:30px;line-height:30px;color:#333;}</style><div class="css-1st94pw"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noreferrer">京ICP备19054504号-2</a></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"JS 自定义监听器","contentHtml":"\u003cp\u003ejs中的自定义监听器分为浏览器DOM端、Node端，最后可以自己实现一个自定义监听器\u003c/p\u003e\n\u003ch3 id=\"user-content-浏览器端\"\u003e\u003ca href=\"#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%AB%AF\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/a\u003e浏览器端\u003c/h3\u003e\n\u003cp\u003e浏览器端的自定义监听器可以通过原生的**\u003ccode\u003eEvent\u003c/code\u003e\u003cstrong\u003e和\u003c/strong\u003e\u003ccode\u003eCustomEvent\u003c/code\u003e**构造函数实现\u003c/p\u003e\n\u003cp\u003e**\u003ccode\u003eEvent\u003c/code\u003e**语法 \u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Event/Event\"\u003e基础\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003e\u003ccode\u003eCustomEvent\u003c/code\u003e\u003c/strong\u003e\u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/CustomEvent\"\u003e基础\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eCustomEvent\u003c/code\u003e相比\u003ccode\u003eEvent\u003c/code\u003e的优势是有个\u003ccode\u003edetail\u003c/code\u003e字段可以为事件传入自定义参数\u003c/p\u003e\n\u003cp\u003e举例使用\u003c/p\u003e\n\u003cp\u003e在两个独立的模块：商品购买，购物车中，可以在购买页面定义一个自定义监听器 \u003cstrong\u003eBuyEvent\u003c/strong\u003e，再在其他模块中监听该事件。当用户购买商品时，通过\u003ccode\u003edispatchEvent\u003c/code\u003e触发该事件\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003ebuy模块\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan\u003e// btnElem 购买按钮\t\u003c/span\u003e\nbtnElem.\u003cspan\u003eaddEventListener\u003c/span\u003e(\u003cspan\u003e'click'\u003c/span\u003e, \u003cspan\u003e(\u003cspan\u003ee\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  \u003cspan\u003e// goodInfo 商品信息\u003c/span\u003e\n  \u003cspan\u003econst\u003c/span\u003e buyEvent = \u003cspan\u003enew\u003c/span\u003e \u003cspan\u003eCustomEvent\u003c/span\u003e(\u003cspan\u003e'buyEvent'\u003c/span\u003e, {\n    \u003cspan\u003edetail\u003c/span\u003e: goodInfo,\n  })\n  \u003cspan\u003edocument\u003c/span\u003e.\u003cspan\u003edispatchEvent\u003c/span\u003e(buyEvent)\n})\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003e购物车模块\u003c/strong\u003e\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan\u003edocument\u003c/span\u003e.\u003cspan\u003eaddEventListener\u003c/span\u003e(\u003cspan\u003e'buyEvent'\u003c/span\u003e, \u003cspan\u003e(\u003cspan\u003ee\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  \u003cspan\u003econsole\u003c/span\u003e.\u003cspan\u003elog\u003c/span\u003e(\u003cspan\u003e`商品模块get，\u003cspan\u003e${e.detail}\u003c/span\u003e`\u003c/span\u003e)\n})\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"user-content-node端\"\u003e\u003ca href=\"#node%E7%AB%AF\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/a\u003eNode端\u003c/h3\u003e\n\u003cp\u003eNode端自带了\u003cstrong\u003eevent\u003c/strong\u003e模块可以实现监听器功能\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan\u003econst\u003c/span\u003e \u003cspan\u003eEventEmitter\u003c/span\u003e = \u003cspan\u003erequire\u003c/span\u003e(\u003cspan\u003e'events'\u003c/span\u003e)\n\n\u003cspan\u003econst\u003c/span\u003e myEvent = \u003cspan\u003enew\u003c/span\u003e \u003cspan\u003eEventEmitter\u003c/span\u003e()\n\nmyEvent.\u003cspan\u003eon\u003c/span\u003e(\u003cspan\u003e'mEvent'\u003c/span\u003e, \u003cspan\u003e(\u003cspan\u003edata\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  \u003cspan\u003econsole\u003c/span\u003e.\u003cspan\u003elog\u003c/span\u003e(data)\n})\n\nmyEvent.\u003cspan\u003eemit\u003c/span\u003e(\u003cspan\u003e'mEvent'\u003c/span\u003e, \u003cspan\u003e'发射！！！'\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"user-content-自定义事件监听器\"\u003e\u003ca href=\"#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC%E5%99%A8\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/a\u003e自定义事件监听器\u003c/h3\u003e\n\u003cp\u003e可以自己实现一个自定义监听器实现上述功能\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan\u003eclass\u003c/span\u003e \u003cspan\u003eEventEmiter\u003c/span\u003e {\n  \u003cspan\u003econstructor\u003c/span\u003e(\u003cspan\u003e\u003c/span\u003e) {\n    \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e = []\n  }\n  \u003cspan\u003eon\u003c/span\u003e(\u003cspan\u003eevent, cb\u003c/span\u003e) {\n    \u003cspan\u003econsole\u003c/span\u003e.\u003cspan\u003elog\u003c/span\u003e(\u003cspan\u003e'this.events'\u003c/span\u003e, \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e)\n    \u003cspan\u003eif\u003c/span\u003e (\u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e[event]) {\n      \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e[event].\u003cspan\u003epush\u003c/span\u003e(cb)\n    } \u003cspan\u003eelse\u003c/span\u003e {\n      \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e[event] = [cb]\n    }\n  }\n  \u003cspan\u003eemit\u003c/span\u003e(\u003cspan\u003eevent\u003c/span\u003e) {\n    \u003cspan\u003econst\u003c/span\u003e cbList = \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e[event]\n    \u003cspan\u003eif\u003c/span\u003e (!cbList) {\n      \u003cspan\u003econsole\u003c/span\u003e.\u003cspan\u003eerror\u003c/span\u003e(\u003cspan\u003e'你注册了事件嘛QAQ'\u003c/span\u003e)\n      \u003cspan\u003ereturn\u003c/span\u003e\n    }\n    \u003cspan\u003elet\u003c/span\u003e args = \u003cspan\u003eArray\u003c/span\u003e.\u003cspan\u003efrom\u003c/span\u003e(\u003cspan\u003earguments\u003c/span\u003e).\u003cspan\u003eslice\u003c/span\u003e(\u003cspan\u003e1\u003c/span\u003e)\n    cbList.\u003cspan\u003eforEach\u003c/span\u003e(\u003cspan\u003e(\u003cspan\u003ecb\u003c/span\u003e) =\u003e\u003c/span\u003e {\n      cb.\u003cspan\u003eapply\u003c/span\u003e(\u003cspan\u003ethis\u003c/span\u003e, args)\n    })\n  }\n}\n\n\u003cspan\u003elet\u003c/span\u003e mEvent = \u003cspan\u003enew\u003c/span\u003e \u003cspan\u003eEventEmiter\u003c/span\u003e()\nmEvent.\u003cspan\u003eon\u003c/span\u003e(\u003cspan\u003e'mEvent'\u003c/span\u003e, \u003cspan\u003e(\u003cspan\u003edata\u003c/span\u003e) =\u003e\u003c/span\u003e {\n  \u003cspan\u003econsole\u003c/span\u003e.\u003cspan\u003elog\u003c/span\u003e(\u003cspan\u003e'got it'\u003c/span\u003e, data)\n})\n\u003cspan\u003esetTimeout\u003c/span\u003e(\u003cspan\u003e() =\u003e\u003c/span\u003e {\n  mEvent.\u003cspan\u003eemit\u003c/span\u003e(\u003cspan\u003e'mEvent'\u003c/span\u003e, \u003cspan\u003e'发射！！！'\u003c/span\u003e)\n}, \u003cspan\u003e2000\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e当然，如果你不想用\u003ccode\u003eclass\u003c/code\u003e的话，用函数也可以实现（PS，这个世界越来越奇怪了，JS在向class靠，而C++却在惦记着函数式编程。。。）\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan\u003efunction\u003c/span\u003e \u003cspan\u003eEventEmiter\u003c/span\u003e(\u003cspan\u003e\u003c/span\u003e) {}\n\u003cspan\u003eEventEmiter\u003c/span\u003e.\u003cspan\u003e\u003cspan\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e = {}\n\u003cspan\u003eEventEmiter\u003c/span\u003e.\u003cspan\u003e\u003cspan\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan\u003eon\u003c/span\u003e = \u003cspan\u003efunction\u003c/span\u003e (\u003cspan\u003eevent, cb\u003c/span\u003e) {\n  \u003cspan\u003econsole\u003c/span\u003e.\u003cspan\u003elog\u003c/span\u003e(\u003cspan\u003e'this.events'\u003c/span\u003e, \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e)\n  \u003cspan\u003eif\u003c/span\u003e (\u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e[event]) {\n    \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e[event].\u003cspan\u003epush\u003c/span\u003e(cb)\n  } \u003cspan\u003eelse\u003c/span\u003e {\n    \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e[event] = [cb]\n  }\n}\n\u003cspan\u003eEventEmiter\u003c/span\u003e.\u003cspan\u003e\u003cspan\u003eprototype\u003c/span\u003e\u003c/span\u003e.\u003cspan\u003eemit\u003c/span\u003e = \u003cspan\u003efunction\u003c/span\u003e (\u003cspan\u003eevent\u003c/span\u003e) {\n  \u003cspan\u003econst\u003c/span\u003e cbList = \u003cspan\u003ethis\u003c/span\u003e.\u003cspan\u003eevents\u003c/span\u003e[event]\n  \u003cspan\u003eif\u003c/span\u003e (!cbList) {\n    \u003cspan\u003econsole\u003c/span\u003e.\u003cspan\u003eerror\u003c/span\u003e(\u003cspan\u003e'你注册了事件嘛QAQ'\u003c/span\u003e)\n    \u003cspan\u003ereturn\u003c/span\u003e\n  }\n  \u003cspan\u003elet\u003c/span\u003e args = \u003cspan\u003eArray\u003c/span\u003e.\u003cspan\u003efrom\u003c/span\u003e(\u003cspan\u003earguments\u003c/span\u003e).\u003cspan\u003eslice\u003c/span\u003e(\u003cspan\u003e1\u003c/span\u003e)\n  cbList.\u003cspan\u003eforEach\u003c/span\u003e(\u003cspan\u003e(\u003cspan\u003ecb\u003c/span\u003e) =\u003e\u003c/span\u003e {\n    cb.\u003cspan\u003eapply\u003c/span\u003e(\u003cspan\u003ethis\u003c/span\u003e, args)\n  })\n}\n\n\u003cspan\u003elet\u003c/span\u003e foo = \u003cspan\u003enew\u003c/span\u003e \u003cspan\u003eEventEmiter\u003c/span\u003e()\n\n\u003cspan\u003e/**\n * 或者这样也行\n * function foo(num) {\n  this.events = {}\n  }\n Object.setPrototypeOf(foo, EventEmiter.prototype)\n */\u003c/span\u003e\n\nfoo.\u003cspan\u003eon\u003c/span\u003e(\u003cspan\u003e'mEvent'\u003c/span\u003e, \u003cspan\u003efunction\u003c/span\u003e (\u003cspan\u003eres, a\u003c/span\u003e) {\n  \u003cspan\u003econsole\u003c/span\u003e.\u003cspan\u003elog\u003c/span\u003e(\u003cspan\u003e'success'\u003c/span\u003e, res, a)\n})\n\n\n\u003cspan\u003esetTimeout\u003c/span\u003e(\u003cspan\u003e() =\u003e\u003c/span\u003e {\n  foo.\u003cspan\u003eemit\u003c/span\u003e(\u003cspan\u003e'mEvent'\u003c/span\u003e, \u003cspan\u003e'发射！！！'\u003c/span\u003e, \u003cspan\u003e'剩余氧气: undefined'\u003c/span\u003e)\n}, \u003cspan\u003e1000\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"user-content-总结\"\u003e\u003ca href=\"#%E6%80%BB%E7%BB%93\" aria-hidden=\"true\" tabindex=\"-1\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/a\u003e总结\u003c/h3\u003e\n\u003cp\u003e监听器本质是一个个\u003cstrong\u003e事件\u003c/strong\u003e，是\u003cstrong\u003e观察者模式\u003c/strong\u003e的实现。OVER！！！\u003c/p\u003e\n","title":"js实现自定义监听器","date":"2020-12-23T14:03:56.000Z","description":"在浏览器端与js端分别实现自定义监听器","tag":"JavaScript"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"JS 自定义监听器"},"buildId":"Xajds82wgprlLoQfKFbdB","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>